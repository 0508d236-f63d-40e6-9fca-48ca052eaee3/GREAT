#!/bin/bash

# ๐ ุณูุฑูุจุช ุฅุตูุงุญ ูุดุงูู package.json ูุงูุชุจุนูุงุช

echo "๐ง ุจุฏุก ุฅุตูุงุญ ูุดุงูู package.json..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# 1. ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
echo "๐พ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ..."
mkdir -p backup
cp package.json backup/package.json.backup 2>/dev/null || true
cp package-lock.json backup/package-lock.json.backup 2>/dev/null || true
echo "โ ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ"

# 2. ุชูุธูู ุดุงูู
echo "๐งน ุชูุธูู ุดุงูู ูููุดุฑูุน..."
rm -rf node_modules
rm -rf .next
rm -rf out
rm -f package-lock.json
echo "โ ุชู ุงูุชูุธูู ุจูุฌุงุญ"

# 3. ุชูุธูู ูุงุด npm
echo "๐๏ธ ุชูุธูู ูุงุด npm..."
npm cache clean --force
echo "โ ุชู ุชูุธูู ุงููุงุด"

# 4. ุชุซุจูุช ุงูุชุจุนูุงุช ุงูุฌุฏูุฏุฉ
echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."
npm install
echo "โ ุชู ุชุซุจูุช ุงูุชุจุนูุงุช ุงูุฃุณุงุณูุฉ"

# 5. ุฅุถุงูุฉ ุชุจุนูุงุช SWC
echo "โก ุฅุถุงูุฉ ุชุจุนูุงุช SWC..."
npm install @swc/core @swc/helpers --save-dev
echo "โ ุชู ุฅุถุงูุฉ SWC ุจูุฌุงุญ"

# 6. ุงุฎุชุจุงุฑ ุงูุจูุงุก
echo "๐๏ธ ุงุฎุชุจุงุฑ ุงูุจูุงุก..."
if npm run build; then
    echo "โ ุงูุจูุงุก ูุฌุญ ุจุฏูู ุฃุฎุทุงุก!"
else
    echo "โ ูุดู ุงูุจูุงุก - ุฑุงุฌุน ุงูุฃุฎุทุงุก ุฃุนูุงู"
    exit 1
fi

# 7. ูุญุต ุงูุตุญุฉ
echo "๐ ูุญุต ุตุญุฉ ุงููุดุฑูุน..."
node -e "console.log('โ Node.js:', process.version)"
npm -v | xargs -I {} echo "โ npm: {}"
echo "โ ุฌููุน ุงููุญูุตุงุช ูุฌุญุช!"

echo ""
echo "๐ ุชู ุฅุตูุงุญ ุฌููุน ูุดุงูู package.json ุจูุฌุงุญ!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "   1. ุฑุงุฌุน ุงููููุงุช ุงููุญุฏุซุฉ"
echo "   2. ุงุฎุชุจุฑ ุงููุดุฑูุน: npm run dev"
echo "   3. ุงูุดุฑ ุงููุดุฑูุน: npm run deploy"
echo ""
